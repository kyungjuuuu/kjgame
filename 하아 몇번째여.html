<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì•Œê³ ë¦¬ì¦˜ ë³´ë¬¼ì°¾ê¸°</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0; padding: 20px; background: #f5f5f5;
    }
    h3 {
      text-align: center;
      line-height: 1.6;
      font-size: 18px;
      margin-top: 10px;
    }
    h1 {
      text-align: center;
      margin-bottom: 0;
    }
    .container {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 20px;
      align-items: flex-start;
    }
    #gameArea {
      text-align: center;
      display: none;
    }
    table {
      margin: 10px auto;
      border-collapse: collapse;
    }
    td {
      width: 40px; height: 40px;
      border: 1px solid #ccc;
      font-size: 24px;
      text-align: center;
      vertical-align: middle;
    }
    td.visited {
      background-color: #a3d5ff;
    }
    #leaderboardBox {
      width: 240px;
      text-align: center;
    }
    #podiumButton, #clearBtn, #restartBtn {
      margin: 10px 0 5px 0;
      padding: 8px 16px;
      font-weight: bold;
      border: none;
      cursor: pointer;
      border-radius: 4px;
    }
    #podiumButton {
      background-color: gold;
    }
    #clearBtn {
      background-color: crimson;
      color: white;
    }
    #restartBtn {
      background-color: #007bff;
      color: white;
      display: none;
    }
    footer {
      margin-top: 40px;
      text-align: center;
      font-size: 14px;
      color: gray;
    }
    #mobileControls {
      margin-top: 20px;
      display: none;
    }
    #mobileControls button {
      font-size: 28px;
      padding: 10px 18px;
      margin: 5px;
      cursor: pointer;
      border-radius: 6px;
      border: 1px solid #333;
      background-color: #eee;
      user-select: none;
    }
    #mobileControls .row {
      text-align: center;
    }
  </style>
</head>
<body>

  <h3>
    2025ë…„ ì—¬ë¦„ë°©í•™ êµìœ¡ê¸°ë¶€ ì™ì™ìº í”„<br />
    ì¥í•­ì¤‘ì•™ì´ˆë“±í•™êµ Ã— ESC 4íŒ€
  </h3>
  <h1>ğŸš¢ ì•Œê³ ë¦¬ì¦˜ ë³´ë¬¼ì°¾ê¸° ğŸª™</h1>

  <div id="startScreen" style="text-align:center;">
    ì´ë¦„: <input type="text" id="playerName" placeholder="ì´ë¦„ ì…ë ¥" />
    <button onclick="startGame(false)">ê²Œì„ ì‹œì‘</button>
    <button onclick="startGame(true)">ëª¨ë°”ì¼ ì‹œì‘</button>
  </div>

  <div class="container">
    <div id="gameArea">
      <p>ë‚¨ì€ ì´ë™ ìˆ˜: <span id="movesLeft">15</span></p>
      <table id="board"></table>
      <p>ì°¾ì€ ë³´ë¬¼: <span id="score">0</span> / 20</p>

      <div id="mobileControls">
        <div class="row">
          <button onclick="move('up')" aria-label="ìœ„ìª½ ì´ë™">â¬†ï¸</button>
        </div>
        <div class="row">
          <button onclick="move('left')" aria-label="ì™¼ìª½ ì´ë™">â¬…ï¸</button>
          <button onclick="move('down')" aria-label="ì•„ë˜ìª½ ì´ë™">â¬‡ï¸</button>
          <button onclick="move('right')" aria-label="ì˜¤ë¥¸ìª½ ì´ë™">â¡ï¸</button>
        </div>
      </div>

      <button id="restartBtn" onclick="restartGame()">ğŸ”„ ë‹¤ì‹œ ì‹œì‘</button>
    </div>

    <div id="leaderboardBox">
      <button id="podiumButton" onclick="showPodium()">ğŸ… í¬ë””ì›€</button>
      <h2>ğŸ† ìˆœìœ„í‘œ</h2>
      <ol id="leaderboard"></ol>
      <button id="clearBtn" onclick="clearLeaderboard()">ğŸ—‘ï¸ ìˆœìœ„í‘œ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <footer>
    ê°œë°œì : í™©ê²½ì£¼
  </footer>

  <script>
    const SIZE = 7;
    const MAX_MOVES = 15;
    let board = [];
    let ship = { x: 3, y: 3 };
    let moves = MAX_MOVES;
    let score = 0;
    let player = "";
    let mobileMode = false;

    function startGame(isMobile) {
      player = document.getElementById("playerName").value.trim();
      if (!player) {
        alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }
      mobileMode = isMobile;

      document.getElementById("startScreen").style.display = "none";
      document.getElementById("gameArea").style.display = "block";
      document.getElementById("mobileControls").style.display = mobileMode ? "block" : "none";

      initBoard();
      renderBoard();
      updateUI();

      document.getElementById("restartBtn").style.display = "none";
    }

    function initBoard() {
      board = Array.from({ length: SIZE }, () => Array.from({ length: SIZE }, () => ""));
      let treasures = 0;
      while (treasures < 20) {
        let x = Math.floor(Math.random() * SIZE);
        let y = Math.floor(Math.random() * SIZE);
        if ((x === 3 && y === 3) || board[y][x] === "ğŸª™") continue;
        board[y][x] = "ğŸª™";
        treasures++;
      }
      ship = { x: 3, y: 3 };
      moves = MAX_MOVES;
      score = 0;
    }

    function move(dir) {
      if (moves <= 0) return;

      const dx = { left: -1, right: 1, up: 0, down: 0 };
      const dy = { left: 0, right: 0, up: -1, down: 1 };

      let newX = ship.x + dx[dir];
      let newY = ship.y + dy[dir];

      if (
        newX < 0 || newX >= SIZE ||
        newY < 0 || newY >= SIZE ||
        board[newY][newX] === "ğŸŒŠ"
      ) return;

      board[ship.y][ship.x] = "ğŸŒŠ";
      ship.x = newX;
      ship.y = newY;

      if (board[ship.y][ship.x] === "ğŸª™") {
        score++;
        board[ship.y][ship.x] = ""; // ë³´ë¬¼ ë¨¹ìœ¼ë©´ ì—†ì–´ì§
      }

      moves--;
      renderBoard();
      updateUI();

      if (moves === 0) {
        endGame();
      }
    }

    function renderBoard() {
      const table = document.getElementById("board");
      table.innerHTML = "";
      for (let y = 0; y < SIZE; y++) {
        const row = document.createElement("tr");
        for (let x = 0; x < SIZE; x++) {
          const cell = document.createElement("td");
          if (x === ship.x && y === ship.y) {
            cell.textContent = "ğŸš¢";
          } else if (board[y][x] === "ğŸª™") {
            cell.textContent = "ğŸª™";
          } else if (board[y][x] === "ğŸŒŠ") {
            cell.textContent = "ğŸŒŠ";
            cell.classList.add("visited");
          } else {
            cell.textContent = "";
          }
          row.appendChild(cell);
        }
        table.appendChild(row);
      }
    }

    function updateUI() {
      document.getElementById("movesLeft").textContent = moves;
      document.getElementById("score").textContent = score;
    }

    function saveScore() {
      let scores = JSON.parse(localStorage.getItem("scores") || "[]");
      scores.push({ name: player, score });
      scores.sort((a, b) => b.score - a.score);
      localStorage.setItem("scores", JSON.stringify(scores));
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const list = document.getElementById("leaderboard");
      list.innerHTML = "";
      const scores = JSON.parse(localStorage.getItem("scores") || "[]");
      scores.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.name} - ${s.score}ê°œ`;
        list.appendChild(li);
      });
    }

    function restartGame() {
      document.getElementById("gameArea").style.display = "none";
      document.getElementById("startScreen").style.display = "block";
      document.getElementById("restartBtn").style.display = "none";
      document.getElementById("mobileControls").style.display = "none";
    }

    function showPodium() {
      const scores = JSON.parse(localStorage.getItem("scores") || "[]");
      let podium = scores.slice(0, 3);
      let message = "ğŸ… Top 3 í¬ë””ì›€ ğŸ…\n\n";
      if (podium.length === 0) {
        message += "ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
      } else {
        podium.forEach((s, i) => {
          message += `${i + 1}ë“±: ${s.name} - ${s.score}ê°œ\n`;
        });
      }
      alert(message);
    }

    function clearLeaderboard() {
      const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      if (pw === "0926") {
        if (confirm("ì •ë§ ìˆœìœ„í‘œë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”? ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
          localStorage.removeItem("scores");
          renderLeaderboard();
        }
      } else {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
      }
    }

    function endGame() {
      alert(`ê²Œì„ ì¢…ë£Œ! ë³´ë¬¼ ${score}ê°œë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
      saveScore();
      document.getElementById("restartBtn").style.display = "inline-block";

      if (mobileMode) {
        // ëª¨ë°”ì¼ì€ ê°•ì œë¡œ ì´ˆê¸°í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
        document.getElementById("gameArea").style.display = "none";
        document.getElementById("startScreen").style.display = "block";
        document.getElementById("mobileControls").style.display = "none";
      }
    }

    // í‚¤ë³´ë“œ ë°©í–¥í‚¤ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼ ëª¨ë“œ ì œì™¸)
    window.addEventListener("keydown", function(e) {
      if (mobileMode) return;
      if (e.key === "ArrowUp") move("up");
      else if (e.key === "ArrowDown") move("down");
      else if (e.key === "ArrowLeft") move("left");
      else if (e.key === "ArrowRight") move("right");
    });

    renderLeaderboard();
  </script>
</body>
</html>
